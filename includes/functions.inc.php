<?php

    /****************************************/
    /* EliteTravel                          */
    /* Desarrollado por IT Labs             */
    /* www.it-labs.com.ve                   */
    /* info@it-labs.com.ve                  */
    /* Enero de 2015                        */
    /****************************************/

//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    // Clase para  prevenir ataques CSRF o XSS mediante par치metros GET.		
    class dXSS{
    var $url;
    var $longitud;

    function TestGet($path){
        $ok = true;
        $baneados =array(chr(34),
        "'",
        "--",
        ";",
        "<",
        "[",
        "&lt;",
        ">",
        "&gt",
        "&quot",
        "&#x27",
        "%",
        "&#x2F",
        "/*",
        "*/",
        "request",
        "select",
        "declare",
        "insert",
        "update",
        "delete",
        "drop",
        "exec(",
        "execute(",
        "cast(",
        "char",
        "nchar",
        "varchar",
        "nvarchar", 
        "substring",
        "sysobject",
        "iframe",
        "syscolumns"
        );

        $recuento=0;
        foreach( $_GET as $key => $value ) {
            for($i=0;$i<sizeof($baneados);$i++) {
                $Cadena = strtoupper($value);
                $Encontrar   = strtoupper($baneados[$i]);
                $pos = strpos($Cadena, $Encontrar);
                if($pos !== false) {
                    $recuento++;
                    }
                if(strlen($Cadena)>$this->longitud){
                    $recuento++;
                    }
                if(preg_match('[^a-z0-9_]',$Cadena)){
                    $recuento++;
                    }	
                }
            }
        if($recuento>0){
           // header('Location: '.$path.'ataque.php');
            }
        }
    }	
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function Seguridad($path){
        
        include_once $path.'includes/config.inc.php';

        // Evitar ataques CSRF o XSS mediante par치metros GET.
        $g = new dXSS();
        $g->url = PREF_URL;
        $g->longitud = 10;
        $g->TestGet($path);

        // Evitamos la inyeccion SQL en los formularios de la pagina
        // Modificamos las variables pasadas por URL 
        foreach( $_GET as $variable => $valor ){ 
            $_GET [ $variable ] = str_replace ( "'" , "'" , $_GET [ $variable ]); 
        } 
        // Modificamos las variables de formularios 
        foreach( $_POST as $variable => $valor ){ 
            $_POST [ $variable ] = str_replace ( "'" , "'" , $_POST [ $variable ]); 
        } 
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function FechaActual($FechaStamp){ 
        $ano = date('Y',$FechaStamp);
        $mes = date('n',$FechaStamp);
        $dia = date('d',$FechaStamp);
        $diasemana = date('w',$FechaStamp);

        $diassemanaN = array("Domingo","Lunes","Martes","Mi&eacute;rcoles","Jueves","Viernes","S치bado");
        $mesesN = array(1=>"Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre");
        return $diassemanaN[$diasemana].", $dia de ". $mesesN[$mes] ." de $ano";
   }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function OptionGetPost($path){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/config.inc.php';
        
        $debug = DEBUG;
       
        //Recepcion  de variable de opcion por GET
        if((!isset($_GET['op'])) && (!isset($_POST['op']))){
            $opcion = "listar";
        }
        else{
            if(!isset($_GET['op'])){
                $opcion = $_POST['op'];
                if ($debug == "on"){
                    echo "*** el valor de \$op _POST = ".@$_POST['op']."***";
                }
            }
            else{
                $opcion = $_GET['op'];
                if ($debug == "on"){
                    echo "*** el valor de \$op _GET = ".@$_GET['op']."***";
                }
            }
        }
        return $opcion;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function BarraTareas($path, $objetivo, $tipo_user, $panel_control, $insertar, $listar, $salir){
        
        echo "<div class=\"row\"> \n"
            ."<div class=\"block clearfix\"> \n";

        if ($tipo_user == "adms"){
            $tu = "administrador";
            $text_panel = "Panel de Control";
        }
        
        if ($tipo_user == "user"){
            $tu = "usuario";
            $text_panel = "Panel de Control";
        }
        
        echo "<div class=\"col-sm-4 col-md-2\"> \n"
            ."<div class=\"icon-box style1\"> \n"
            ."<i class=\"soap-icon-user icon_background_blue\"></i> \n";
        if ($tipo_user == "adms"){
                echo $_SESSION['sson_nomb']." ".$_SESSION['sson_apll']." \n";
        }
        if ($tipo_user == "user"){
                echo $_SESSION['sson_nomb']." \n";
        }     
        echo "</div> \n"
            ."</div> \n";
        
//        if ($tipo_user == "user"){
//            
//            echo "<a id=\"barnav_panel\" href=\"".$path."user/user_mis_reservas.php\"> \n"
//                ."<div class=\"col-sm-4 col-md-2\"> \n"
//                ."<div class=\"icon-box style1\"> \n"
//                ."<i class=\"soap-icon-baggage-2\"></i> \n"
//                ."Mis Reservas \n"
//                ."</div> \n"
//                ."</div> \n"        
//                ."</a> \n";
//            
//            echo "<a id=\"barnav_panel\" href=\"".$path."user/user_cambio_clave.php\"> \n"
//                ."<div class=\"col-sm-4 col-md-2\"> \n"
//                ."<div class=\"icon-box style1\"> \n"
//                ."<i class=\"soap-icon-key\"></i> \n"
//                ."Cambio de Clave \n"
//                ."</div> \n"
//                ."</div> \n"        
//                ."</a> \n";
//        }
        
        if ($panel_control == "on"){
            
            if ($tipo_user == 'adms'){
                echo "<a id=\"barnav_panel\" href=\"".$path."adms/adms_panel_control.php\"> \n";
            }
            if ($tipo_user == 'user'){
                echo "<a id=\"barnav_panel\" href=\"".$path."user/user_panel_control.php\"> \n";
            }
            echo "<div class=\"col-sm-4 col-md-3\"> \n"
            ."<div class=\"icon-box style1\"> \n"
            ."<i class=\"soap-icon-block\"></i> \n"
            .$text_panel." \n"
            ."</div> \n"
            ."</div> \n"        
            ."</a> \n";
        }
        
        if ($insertar == "on"){
            echo "<a id=\"barnav_new\" href=\"".$objetivo."?op=insertar\"> \n"
                ."<div class=\"col-sm-6 col-md-2\"> \n"
                ."<div class=\"icon-box style1\"> \n"
                ."<i class=\"soap-icon-doc-plus icon_background_green\"></i> \n"    
                ."Nuevo registro \n"
                ."</div> \n"
                ."</div> \n"        
                ."</a> \n";
        }
        
        if ($listar == "on"){
            echo "<a id=\"barnav_table\" href=\"".$objetivo."?op=listar\"> \n"
                ."<div class=\"col-sm-6 col-md-3\"> \n"
                ."<div class=\"icon-box style1\"> \n"
                ."<i class=\"soap-icon-list icon_background_cyan\"></i> \n"       
                ."Tabla de consulta \n"
                ."</div> \n"
                ."</div> \n"     
                ."</a> \n";
        }
        
        if ($salir == "on"){
            echo "<a id=\"barnav_logout\" href=\"".$path."logout.php\"> \n"
                ."<div class=\"col-sm-6 col-md-2\"> \n"
                ."<div class=\"icon-box style1\"> \n"
                ."<i class=\"soap-icon-elevator icon_background_red\"></i> \n"        
                ."Salir \n"
                ."</div> \n"
                ."</div> \n"     
                ."</a> \n";
        }
       
        echo "</div><!-- col-sm-12 col-md-12 -->\n"
            ."</div><!-- row fin --> \n";
        
       
    }  
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

  
    // Funcion de cierre de los formularios de incercion de datos
    //
    // $op:         opcion del formulario. valores: "insertar | editar"
    //     
    function FormFooter($op, $id){
        echo "<div class=\"form-btn-nav\"> \n"           
            ."<li><input class=\"button blue\" type=\"submit\" value=\"Enviar\" /></li> \n"
            ."<li><input class=\"button blue\" type=\"reset\" value=\"Borrar\" /></li> \n"
            ."</div> \n"

            ."<input type=\"hidden\" id=\"control\" name=\"control\" value=\"1\"> \n";
                 
            echo "<input type=\"hidden\" id=\"op\" name=\"op\" value=\"".$op."\"> \n"
                ."<input type=\"hidden\" id=\"id\" name=\"id\" value=\"".$id."\"> \n";           

         echo "</form> \n"

            ."</fieldset> \n"

            ."</section> \n"
            ."<!-- end form --> \n";
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
        
    function DataTablesInicio($legend){
        echo "<fieldset class=\"form-fieldset\"> \n"
            ."<legend>".$legend."</legend> \n"
            ."<div id=\"contenedor_datatables\"> \n";
    }    
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function DataTablesFinal(){
        echo "</div> \n"
            ."</fieldset> \n";
    }    
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function MensajeDBDebuger($funcion, $consulta){            
        $mensaje_debuger_db = "<div class=\"notification debug\"> \n"
            ."<span></span>  \n"
            ."<div class=\"text\"> \n"
            ."<p><strong>Debug de ".$funcion.":</strong>&nbsp;&nbsp;&nbsp;&nbsp;".$consulta."</p> \n"
            ."</div> \n"
            ."</div> \n";
        return $mensaje_debuger_db;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function MensajeDBError($operacion, $error){            
        $mensaje_debuger_db = "<div class=\"notification error\"> \n"
            ."<span></span>  \n"
            ."<div class=\"text\"> \n"
            ."<p>Ocurrieron errores al intentar ".$operacion." valores en la base de datos.
            analizar el mensaje enviado: <strong>$error</strong></p> \n"
            ."</div> \n"
            ."</div> \n";
        return $mensaje_debuger_db;
    } 
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    
    function MensajeErrorCaptcha(){
        $mensaje_error_captcha = "<div class=\"notification error\"> \n"
            ."<span></span> \n"
            ."<div class=\"text\"> \n"
            ."<p><strong>Error!</strong> Has escrito mal el texto del captcha, por favor inetentalo de nuevo</p> \n"
            ."</div> \n"
            ."</div> \n";
        return $mensaje_error_captcha;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    function MensajeLogin ($mensaje_login){
        switch ($mensaje_login){
            
            case "error-login":
                
                $mensaje = "<div class=\"row-fluid\"> \n"
                    ."<div class=\"span12 module_cont module_messageboxes\"> \n"
                    ."<div class=\"shortcode_messagebox box_type3\"> \n"
                    ."<p><strong>&iexcl;Error!</strong> Los datos que ha suministrado no son correctos. Por favor ingrese direcci&oacute;n de correo electr&oacute;nico y contrase&ntilde;a validas</p> \n"                    
                    ."<a href=\"javascript:void(0)\" class=\"box_close\"></a> \n"
                    ."</div> \n"
                    ."</div><!-- .module_cont --> \n"
                    ."</div><!-- .row-fluid --> \n";

            break;
        
            case "success-login":
                
                $mensaje = "<div class=\"row-fluid\"> \n"
                    ."<div class=\"span12 module_cont module_messageboxes\"> \n"
                    ."<div class=\"shortcode_messagebox box_type5\"> \n"
                    ."<p><strong>&iexcl;Exito!</strong> Ha logrado iniciar sesi&oacute;n</p> \n"
                    ."<a href=\"javascript:void(0)\" class=\"box_close\"></a> \n"
                    ."</div> \n"
                    ."</div><!-- .module_cont --> \n"
                    ."</div><!-- .row-fluid --> \n";
              
            break;
        }
            
            return $mensaje;
    } 
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
     
    function MensajeGenerico ($tipo, $texto){
        switch ($tipo){
            
            case "error":
                $class_mensaje = "notification error";
                $tipo_mensaje = "Error";
            break;
        
            case "success":            
                $class_mensaje = "notification success";
                $tipo_mensaje = "Exito";
            break;
        }
            $mensaje = "<div class=\"".$class_mensaje."\"> \n"
                    ."<span></span> \n"
                    ."<div class=\"text\"> \n"
                    ."<p><strong>&iexcl;".$tipo_mensaje."!</strong> ".$texto."</p> \n"
                    ."</div> \n"
                    ."</div> \n";
            
            return $mensaje;
    } 
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    
    // Funcion para obtener la direccion ip de los clientes
    function GetClientIP() {
        $ipaddress = '';
        if (isset($_SERVER['HTTP_CLIENT_IP']))
            $ipaddress = $_SERVER['HTTP_CLIENT_IP'];
        else if(isset($_SERVER['HTTP_X_FORWARDED_FOR']))
            $ipaddress = $_SERVER['HTTP_X_FORWARDED_FOR'];
        else if(isset($_SERVER['HTTP_X_FORWARDED']))
            $ipaddress = $_SERVER['HTTP_X_FORWARDED'];
        else if(isset($_SERVER['HTTP_FORWARDED_FOR']))
            $ipaddress = $_SERVER['HTTP_FORWARDED_FOR'];
        else if(isset($_SERVER['HTTP_FORWARDED']))
            $ipaddress = $_SERVER['HTTP_FORWARDED'];
        else if(isset($_SERVER['REMOTE_ADDR']))
            $ipaddress = $_SERVER['REMOTE_ADDR'];
        else
            $ipaddress = 'IP Desconocida';
            //echo $ipaddress;
        return $ipaddress;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    
     function SessionValidate($path, $tipo) {
        
        // inclusion de las funciones de bases de datos
        require_once $path."includes/db.inc.php";
        require_once $path."includes/config.inc.php";
        
        $debug = DEBUG;
        
        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion();
                         
        // Comprobacion del registro de la session del usuario
        $sql = "SELECT * FROM itlb_sson WHERE (id = '".@$_SESSION['sson_id']."' AND  sson_tipo = '".@$_SESSION['sson_tipo']."' AND sson_tokn = '".@$_SESSION['tokn']."' AND  sson_agnt = '".@$_SESSION['sson_agnt']."' AND sson_dcip = '".@$_SESSION['sson_dcip']."')";
        $query = $conec->itl_dbQuery($sql, $debug);
        $registro = $conec->itl_dbFetchObjet($query);
        $rs_existe_registro = $conec->itl_dbNumRows($registro);
        
        if (($rs_existe_registro == 1) AND ($registro->sson_tipo == $tipo)){
            $session_validate = TRUE;
            
            // Calculamos el tiempo transcurrido
            $fecha_hora_inicio = $_SESSION['sson_ufch']; 
            $ahora = date("Y-n-j H:i:s"); 
            $tiempo_transcurrido = (strtotime($ahora)-strtotime($fecha_hora_inicio));
                
                //comparacion del tiempo transcurrido 
                if($tiempo_transcurrido >= 2000) { 
                   // echo $tiempo_transcurrido;
                    session_unset();
                    session_destroy();
                    
                    if ($tipo == "adms"){
                        header("Location: ".$path."login_administrador.php");
                    }
                    if ($tipo == "user"){
                        header("Location: ".$path."login_usuario.php");
                    }
                    //sino, actualizo la fecha de la sesi칩n 
                    }
                else {
                        $_SESSION['sson_ufch'] = $ahora; 
                }
        }
        else{
            $session_validate = FALSE;
            session_unset();
            session_destroy();
            if ($tipo == "adms"){
                echo "<script type=\"text/javascript\">window.location=\"".$path."login_administrador.php\"</script> \n";

                
            }
            if ($tipo == "user"){
                echo "<script type=\"text/javascript\">window.location=\"".$path."login_usuario.php\"</script> \n";
            }
        }
        //echo $session_validate;
        return $session_validate;
        
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    
    function Fecha($fecha, $tipo){
            $agno = date("Y",strtotime($fecha)); //<-- A침o
            $mes = date("m",strtotime($fecha)); //<-- n칰mero de mes (01-31)
            $dia = date("d",strtotime($fecha)); //<-- D칤a del mes (1-31)
            $nombre_dia = date('l',strtotime($fecha));  //<-- D칤a de la semana(Lunes - Domingo)
            $nombre_mes = date('F',strtotime($fecha));	

            // Obtenemos y traducimos el nombre del d칤a
            if ($nombre_dia=="Monday") $nombre_dia="Lunes";
            if ($nombre_dia=="Tuesday") $nombre_dia="Martes";
            if ($nombre_dia=="Wednesday") $nombre_dia="Mi&eacute;rcoles";
            if ($nombre_dia=="Thursday") $nombre_dia="Jueves";
            if ($nombre_dia=="Friday") $nombre_dia="Viernes";
            if ($nombre_dia=="Saturday") $nombre_dia="Sabado";
            if ($nombre_dia=="Sunday") $nombre_dia="Domingo";

            // Obtenemos y traducimos el nombre del mes
            if ($nombre_mes=="January"){
                $nombre_mes="Enero";
                $nombre_mesc="Ene";
            }
            if ($nombre_mes=="February"){
                $nombre_mes="Febrero";
                $nombre_mesc="Feb";
            }
            if ($nombre_mes=="March"){
                $nombre_mes="Marzo";
                $nombre_mesc="Mar";
            }
            if ($nombre_mes=="April"){
                $nombre_mes="Abril";
                $nombre_mesc="Abr";
            }
            if ($nombre_mes=="May"){
                $nombre_mes="Mayo";
                $nombre_mesc="May";
            }
            if ($nombre_mes=="June"){
                $nombre_mes="Junio";
                $nombre_mesc="Jun";
            }
            if ($nombre_mes=="July"){
                $nombre_mes="Julio";
                $nombre_mesc="Jul";
            }
            if ($nombre_mes=="August"){
                $nombre_mes="Agosto";
                $nombre_mesc="Ago";
            }
            if ($nombre_mes=="September"){
                $nombre_mes="Septiembre";
                $nombre_mesc="Sep";
            }
            if ($nombre_mes=="October"){
                $nombre_mes="Octubre";
                $nombre_mesc="Oct";
            }
            if ($nombre_mes=="November"){
                $nombre_mes="Noviembre";
                $nombre_mesc="Nov";
            }
            if ($nombre_mes=="December"){
                $nombre_mes="Diciembre";
                $nombre_mesc="Dic";
            }

            if ($tipo == "fecha"){
                // obtenemos la fecha completa
                $fechan = $nombre_dia." ".$dia." de ".$nombre_mes." de ".$agno.".";
            }
            if ($tipo == "mesc"){
                $fechan = $nombre_mesc;
            }
            if ($tipo == "fecha_corta"){
                $fechan = $nombre_mesc." ".date("d, Y",strtotime($fecha));
            } 
            
            if ($tipo == "mesy"){
                $fechan = $nombre_mesc." ".date("Y",strtotime($fecha));
            }
            
            if ($tipo == "mes"){
                $fechan = $nombre_mes;
            }
            
            if ($tipo == "mesc-dia"){
                $fechan = $nombre_mesc." ".date("d",strtotime($fecha));
            }
            
            if ($tipo == "dia"){
                $fechan = date("d",strtotime($fecha));
            }
            
            return $fechan;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function GoogleMap($path){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/db.php';
        require_once $path.'includes/config.php';
        
        $debug = DEBUG;
        
        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion();
        
        // Consulta de o registros
        $sche = "";
        $tabla = "itlb_pref";
        $campos = "pref_glat, pref_glng, pref_gzom";
        $criterio = "id = 1";
        $orden = "";
        $clausula = "";
        $registro = $conec->itl_dbConsulta($sche, $tabla, $campos, $criterio, $orden, $clausula, $debug);
        $rs_registro = $conec->itl_dbFetchObjet($registro);	
    
        $google_map = "<script  src=\"http://maps.google.com/maps/api/js?sensor=true\"></script> <!-- google maps --> \n"
            ."<script  src=\"".$path."js/jquery.ui.map.full.min.js\"></script> <!-- jquery plugin for google maps --> \n"
                
        ."<script> \n"
        ."/* <![CDATA[ */ \n"
        ."jQuery(document).ready(function($) { \n"
        ."'use strict'; \n"

        ."// GOOGLE MAPS START \n"
        ."$(function() { \n"
        ."//google maps \n"

        ."var yourStartLatLng = new google.maps.LatLng(".$rs_registro->pref_glat.", ".$rs_registro->pref_glng."); \n"
        ."$('.map_canvas').gmap({'center': yourStartLatLng, 'zoom': ".$rs_registro->pref_gzom.", 'disableDefaultUI': true, 'callback': function() { \n"        
        ."var self = this; \n"
        ."self.addMarker({'position': this.get('map').getCenter()}); \n"
       
        ."}}); \n"
        ."}); // GOOGLE MAPS END \n"
             

        ."}); \n"

        ."/* ]]> */ \n"
        ."</script> \n";
        
        return $google_map;
        
        }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
             
        // Funcion para reemplazar caracteres especiales para fpdf
        function FPDFSpecialChars($texto){
        $find = array('&aacute;', '&eacute;', '&iacute;', '&oacute;', '&uacute;', '&ntilde;', '&quot;', '&euro;', '&uuml;', '&Aacute;', '&Eacute;', '&Iacute;', '&Oacute;', '&Uacute;', '&Ntilde;', '&Uuml;', '&ccedil;', '&Ccedil;', '&copy;', '&deg;', '&ordm;', '&iquest;', '&iexcl;', '&lt;', '&gt;', '&#47;', '&#42;', '&quot;');    
        $repl = array('치', '칠', '칤', '칩', '칰', '침', '\"', '', '칲', '츼', '칄', '칈', '칍', '칔', '칌', '칖', '칞', '칂', '춸', '춿', '췈', '', '춰', '<', '>', '/', '*', '"');
        $textofpdf = utf8_decode(str_replace ($find, $repl, $texto));
        return $textofpdf;	
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    
    function TablaConsultaPublica($path, $tabla, $sql, $legend, $datatable){
      
        // Inclusion de archivos necesarios
        require_once $path.'includes/db.php';
        require_once $path.'includes/config.php';
        
        // Control de errores
        $debug = DEBUG;
        
        // Prefijo de la tabla
        $tabla_pref = substr($tabla , -4);
        
        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion(); 
        
        // Consulta de la tabla
        $query = $conec->itl_dbQuery($sql, $debug);

        // Creacion de la tabla de consulta de datos
        echo "<fieldset class=\"form-fieldset\"> \n"
            ."<legend class =\"legend_datatable\">".$legend."</legend> \n"
            ."<div id=\"contenedor_datatables\"> \n";

        // Tabla de la consulta
        echo "<table id=\"datables\" class= \"display\"> \n";

        // cabecera de la tabla
        echo "<thead> \n"
            ."<tr> \n";

        // Campos editables para la cabecera de la tabla
            
        foreach($datatable as $item){
            echo "<th width=\"".$item['width']."\"> ".$item['nombre']."</th> \n";              
        }

        echo "</thead> \n";

        // cuerpo de la tabla
        echo "<tbody> \n";

        // ciclo para mostrar los registros
        while ($rs_datos = $conec->itl_dbFetchArray($query)) {

            // inicio de la fila
            echo "<tr> \n";

            // Otros campos de la tabla
            foreach ($datatable as $valor){
                
                if ($valor['campo'] == 'descripcion'){
                    $rs_datos[$valor['campo']] = $valor['descripcion'];
                }

                //echo $valor['formato']." \n";

               // Tratamiento de los datos
                switch ($valor['formato']) {
                    
                    case "normal":
                        echo "<td>".$rs_datos[$valor['campo']]."</td> \n";
                    break;
                
                    case "date":
                        echo "<td>".date("d\-m\-Y", strtotime($rs_datos[$valor['campo']]))."</td> \n";
                    break;
                
                    case "imagen":
                        echo "<td> \n"
                            ."<img id=\"datatable_img\" src=\"".$path."thumbs/".$valor['folder'].$rs_datos[$valor['campo']]."\" alt=\"".$rs_datos[$valor['campo']]."\" title=\"".$rs_datos[$valor['campo']]."\"> \n"
                            ."</td> \n";
                    break;
                
                     case "pdf":
                        echo "<td> \n"
                            ."<a href=\"".$path."uploads/".$valor['folder'].$rs_datos[$valor['campo']]."\" alt=\"".$rs_datos[$valor['campo']]."\" > \n"                          
                            //."<img id=\"datatable_img\" src=\"".$path."img/icons/64x64/pdf_file.png\" alt=\"".$rs_datos[$valor['campo']]."\" title=\"".$rs_datos[$valor['campo']]."\"> \n"
                            ."<span class=\"icon-file-pdf\"> Descargar PDF</span> \n"
                            ."</a> \n"
                            ."</td> \n";
                    break;
                
                    case "time":
                        echo "<td>".date("h\:i\ a", strtotime($rs_datos[$valor['campo']]))."</td> \n";
                    break;
                
                    case "short":
                        if (strlen($rs_datos[$valor['campo']]) >= 150){
                            echo "<td>".substr($rs_datos[$valor['campo']],0,strrpos(substr($rs_datos[$valor['campo']],0,150)," "))." ...</td> \n";
                        }
                        else {
                            echo "<td>".$rs_datos[$valor['campo']]."</td> \n";
                        }
                    break;
                }
                
            }
            
            // Final de la fila
            echo "</tr> \n";
            
        } // Fin del ciclo que muestra los registros

        
        // cierre del cuerpo de la tabla
        echo "</tbody> \n";

        // Cierre de la tabla
        echo "</table> \n";
        
       // echo "</div> \n"
         echo "</fieldset> \n";
    }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
    
    // Datos del Administrador
    function AdminDatos($path, $id_adms){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/db.php';
        require_once $path.'includes/config.php';

        $debug = DEBUG;

        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion();

        // Consulta de los datos del administrador
        $sql_adms = "SELECT * FROM itlb_adms WHERE id = '".$id_adms."'";
        $consulta_adms = $conec->itl_dbQuery($sql_adms, $debug);
        $datos_adms = $conec->itl_dbFetchObjet($consulta_adms);

        // Fieldset de lo datos del administrador
        echo "<div class=\"row\"> \n"
            ."<div class=\"sidebar col-sm-12 col-md-12\"> \n"
            ."<div class=\"pricing-table white box adms_datos\"> \n"
            ."<div class=\"header clearfix\"> \n"
            ."<i class=\"soap-icon-friends circle yellow-color\"></i> \n"
            ."<h3 class=\"box-title\"><span>Datos del Administrador<small>Panel del Administrador</small></span></h3> \n"
            ."<span class=\"price\"><small class=\"hora_datatabla\">Fecha: ".date('d-n-Y')."</small>".date('h\:i\ a')."</span> \n"
            ."</div> \n";

        // Inicio de la tabla	
        echo "<table class=\"adms_datos\"> \n"
            ."<tr> \n";

        // Nombre
        echo "<td width=\"200\" ><strong>Nombre:</strong></td> \n"
            ."<td>".$datos_adms->adms_nomb."</td>\n ";

        // Avatar
        $avatar = ($datos_adms->adms_sexo == "M") ? "administrador.png" : "administradora.png";            
        echo "<td width=\"140\" rowspan=\"4\"> \n"
            ."<div id=\"caja_avatar\"> \n"
            ."<img src=\"".$path."images/icon/128x128/".$avatar."\" alt=\"".$datos_adms->adms_nomb." ".$datos_adms->adms_apll."\" class=\"img_adms\"/> \n"
            ."</div> \n"
            ."</td> \n"
            ."</tr> \n";

        // Apellido
        echo "<tr> \n"
            ."<td><strong>Apellido:</strong></td> \n"
            ."<td>".$datos_adms->adms_apll."</td> \n"
            ."</tr> \n";

        // E-mail
        echo "<tr> \n"
            ."<td><strong>E-mail:</strong></td> \n"
            ."<td>".$datos_adms->adms_mail."</td> \n"
            ."</tr> \n";

        // Estado del administrador	
        echo "<tr> \n"
            ."<td><strong>Estado del Administrador:</v></td> \n"
            ."<td> \n";

        $user_estd = ($datos_adms->adms_estd == "1") ? "Activo" : "Inactivo";

        echo $user_estd."</td> \n"
            ."</tr> \n";

        // Fin de la tabla y el fieldset
        echo "</table> \n";
            
        echo "</div> \n"
            ."</div> \n"
            ."</div><!-- sidebar col-sm-12 col-md-12 / fin --> \n"
            ."</div> \n";
    }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
    
    // Datos del Administrador
    function HotelDatos($path, $id_hotl){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/db.php';
        require_once $path.'includes/config.php';

        $debug = DEBUG;

        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion();

        // Consulta de los datos del administrador
        $sql_hotl = "SELECT itlb_hotl.id AS hotl_id, hotl_estd, hotl_freg, hotl_dest, hotl_rsme, hotl_nomb, hotl_img1, "
            ."itlb_ciud.id AS ciud_id, ciud_nomb, ciud_pais, itlb_pais.id AS pais_id, pais_nomb "
            ."FROM itlb_hotl "
            ."JOIN itlb_ciud ON (hotl_ciud = itlb_ciud.id) "
            ."JOIN itlb_pais ON (ciud_pais = itlb_pais.id) "
            ."WHERE itlb_hotl.id = '".$id_hotl."'";
        $consulta_hotl = $conec->itl_dbQuery($sql_hotl, $debug);
        $datos_hotl = $conec->itl_dbFetchObjet($consulta_hotl);

        // Fieldset de lo datos del administrador
        echo "<div class=\"row\"> \n"
            ."<div class=\"sidebar col-sm-12 col-md-12\"> \n"
            ."<div class=\"pricing-table white box adms_datos\"> \n"
            ."<div class=\"header clearfix\"> \n"
            ."<i class=\"soap-icon-friends circle yellow-color\"></i> \n"
            ."<h3 class=\"box-title\"><span>Datos del Hotel<small>Panel del Administrador</small></span></h3> \n"
            ."<span class=\"price\"><small class=\"hora_datatabla\">Fecha: ".date('d-n-Y')."</small>".date('h\:i\ a')."</span> \n"
            ."</div> \n";

        // Inicio de la tabla	
        echo "<table class=\"adms_datos\"> \n"
            ."<tr> \n";

        // Nombre
        echo "<td width=\"200\" ><strong>Nombre:</strong></td> \n"
            ."<td>".$datos_hotl->hotl_nomb."</td>\n ";

        // Imagen
        echo "<td width=\"140\" rowspan=\"4\"> \n"
            ."<div id=\"caja_avatar\"> \n"
            ."<img width=\"270\" height=\"160\" src=\"".$path."uploads/imagenes/hoteles/".$datos_hotl->hotl_img1."\" alt=\"".$datos_hotl->hotl_nomb."\" class=\"img_adms\"/> \n"
            ."</div> \n"
            ."</td> \n"
            ."</tr> \n";

        // Pais
        echo "<tr> \n"
            ."<td><strong>Pa&iacute;s:</strong></td> \n"
            ."<td>".$datos_hotl->pais_nomb."</td> \n"
            ."</tr> \n";

        // Ciudad
        echo "<tr> \n"
            ."<td><strong>Resumen:</strong></td> \n"
            ."<td>".$datos_hotl->ciud_nomb."</td> \n"
            ."</tr> \n";

        // Resumen del Hotel	
        echo "<tr> \n"
            ."<td><strong>Resumen del Hotel:</v></td> \n"
            ."<td>".$datos_hotl->hotl_rsme."</td> \n"
            ."</tr> \n";

        // Fin de la tabla y el fieldset
        echo "</table> \n";
            
        echo "</div> \n"
            ."</div> \n"
            ."</div><!-- sidebar col-sm-12 col-md-12 / fin --> \n"
            ."</div> \n";
    }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

    // Datos del Usuario
    function UserDatos($path, $id_user){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/db.php';
        require_once $path.'includes/config.php';

        $debug = DEBUG;

        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion();

        // Consulta de los datos del administrador
        $sql_user = "SELECT * FROM itlb_user WHERE id = '".$id_user."'";
        $consulta_user = $conec->itl_dbQuery($sql_user, $debug);
        $datos_user = $conec->itl_dbFetchObjet($consulta_user);

        // Fieldset de lo datos del administrador
        echo "<div class=\"user_datos\"> \n"
            ."<fieldset class=\"user_datos\"> \n"

            ."<legend class=\"legend_datatable\"> \n"
            ."Datos del Usuario \n"
            ."</legend> \n";

        // Inicio de la tabla	
        echo "<table class=\"user_datos\"> \n"
            ."<tr> \n";

        // Nombre
        echo "<td width=\"200\" ><strong>Nombre:</strong></td> \n"
            ."<td>".$datos_user->user_nomb."</td>\n ";

        // Avatar
//        $avatar = ($datos_user->user_sexo == "M") ? "administrador.png" : "administradora.png";            
//        echo "<td width=\"140\" rowspan=\"4\"> \n"
//            ."<div id=\"caja_avatar\"> \n"
//            ."<img src=\"".$path."images/icons/128x128/".$avatar."\" alt=\"".$datos_user->user_nomb." ".$datos_user->user_apll."\" class=\"img_adms\"/> \n"
//            ."</div> \n"
//            ."</td> \n"
        echo"</tr> \n";

        // Apellido
        echo "<tr> \n"
            ."<td><strong>Apellido:</strong></td> \n"
            ."<td>".$datos_user->user_apll."</td> \n"
            ."</tr> \n";
        
        // Numero de cedula y nacionalidad
        echo "<tr> \n"
            ."<td><strong>N&ordm; de C&eacute;dula:</strong></td> \n"
            ."<td>".$datos_user->user_ncld."-".$datos_user->user_cdla."</td> \n"
            ."</tr> \n";
        
        // Nombre de la Empresa
        echo "<tr> \n"
            ."<td><strong>Empresa:</strong></td> \n"
            ."<td>".$datos_user->user_empr."</td> \n"
            ."</tr> \n";
        
        // Cargo en la empresa
        echo "<tr> \n"
            ."<td><strong>Cargo:</strong></td> \n"
            ."<td>".$datos_user->user_crgo."</td> \n"
            ."</tr> \n";

        // E-mail
        echo "<tr> \n"
            ."<td><strong>E-mail:</strong></td> \n"
            ."<td>".$datos_user->user_mail."</td> \n"
            ."</tr> \n";
        
        // Telefono
        echo "<tr> \n"
            ."<td><strong>Tel&eacute;fono:</strong></td> \n"
            ."<td>".$datos_user->user_tlef."</td> \n"
            ."</tr> \n";

        // Direccin	
        echo "<tr> \n"
            ."<td><strong>Direcci&oacute;n:</v></td> \n"
            ."<td>".$datos_user->user_dirc."</td> \n"
            ."</tr> \n";

        // Fin de la tabla y el fieldset
        echo "</table> \n"
            ."</div> \n"
            ."</div> \n"
            ."</div><!-- sidebar col-sm-12 col-md-12 / fin --> \n"
            ."</div> \n";
    }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
        
    // Datos del Plan
    function PlanDatos($path, $id){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/db.php';
        require_once $path.'includes/config.php';

        $debug = DEBUG;

        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion();

        // Consulta de los datos del administrador
        $sql_plan = "SELECT itlb_plan.id AS plan_id, plan_pais, plan_nomb, plan_desc, plan_fini, plan_ffin, "
            ."itlb_pais.id AS pais_id, pais_nomb "    
            ."FROM itlb_plan INNER JOIN itlb_pais ON (plan_pais = itlb_pais.id) "
            ."WHERE itlb_plan.id = '".$id."'";
        $consulta_plan = $conec->itl_dbQuery($sql_plan, $debug);
        $datos_plan = $conec->itl_dbFetchObjet($consulta_plan);

         // Fieldset de lo datos del administrador
        echo "<div class=\"row\"> \n"
            ."<div class=\"sidebar col-sm-12 col-md-12\"> \n"
            ."<div class=\"pricing-table white box adms_datos\"> \n"
            ."<div class=\"header clearfix\"> \n"
            ."<i class=\"soap-icon-friends circle yellow-color\"></i> \n"
            ."<h3 class=\"box-title\"><span>Datos del Plan<small>Panel del Administrador</small></span></h3> \n"
            ."<span class=\"price\"><small class=\"hora_datatabla\">Fecha: ".date('d-n-Y')."</small>".date('h\:i\ a')."</span> \n"
            ."</div> \n";

        // Inicio de la tabla	
        echo "<table class=\"user_datos\"> \n"
            ."<tr> \n";
        
        // Nombre
        echo "<tr> \n"
            ."<td><strong>Nombre del Plan:</strong></td> \n"
            ."<td>".$datos_plan->plan_nomb."</td> \n"
            ."</tr> \n";

        // Pais
        echo "<td width=\"200\" ><strong>Pa&iacute;s:</strong></td> \n"
            ."<td>".$datos_plan->pais_nomb."</td>\n "
            ."</tr> \n";

        // Descripcion
        echo "<tr> \n"
            ."<td><strong>Descripci&oacute;n:</strong></td> \n"
            ."<td>".$datos_plan->plan_desc."</td> \n"
            ."</tr> \n";
        
        // Fecha de inicio
        echo "<tr> \n"
            ."<td><strong>Fecha de Inicio:</strong></td> \n"
            ."<td>".date("d\-m\-Y", strtotime($datos_plan->plan_fini))."</td> \n"
            ."</tr> \n";
        
        // Fecha de culminacion
        echo "<tr> \n"
            ."<td><strong>Fecha de Culminaci&oacute;n:</strong></td> \n"
            ."<td>".date("d\-m\-Y", strtotime($datos_plan->plan_ffin))."</td> \n"
            ."</tr> \n";

        // Fin de la tabla y el fieldset
        echo "</table> \n"
            ."</fieldset> \n"
            ."</div> \n"
            ."<br>";
    }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

    // Album Datos
    function AlbumDatos($path, $id_glra){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/db.php';
        require_once $path.'includes/config.php';

        $debug = DEBUG;

        // Crear la instancia y conectar a la BD
        $conec = new itl_db();
        $conec->itl_dbConexion();

        // Consulta de los datos del administrador
        $sql_glra = "SELECT itlb_glra.id AS glra_id, glra_glrc, glra_ttlo, glra_fech, glra_resm, glra_estd, itlb_glrc.id AS glrc_id, glrc_nomb  FROM itlb_glra INNER JOIN itlb_glrc ON (glra_glrc = itlb_glrc.id) WHERE itlb_glra.id = '".$id_glra."'";
        $consulta_glra = $conec->itl_dbQuery($sql_glra, $debug);
        $datos_glra = $conec->itl_dbFetchObjet($consulta_glra);

        // Album datos
        echo "<div class=\"adms_datos\"> \n"
            ."<fieldset class=\"adms_datos\"> \n"

            ."<legend class=\"legend_datatable\"> \n"
            ."Datos del Album \n"
            ."</legend> \n";

        // Inicio de la tabla	
        echo "<table class=\"adms_datos\"> \n"
            ."<tr> \n";

        // Fecha
        echo "<td width=\"200\" ><strong>Fecha:</strong></td> \n"
            ."<td>".date("d\-m\-Y", strtotime($datos_glra->glra_fech))."</td>\n ";

        // Categoria
        echo "<tr> \n"
            ."<td><strong>Categoria:</strong></td> \n"
            ."<td>".$datos_glra->glrc_nomb."</td> \n"
            ."</tr> \n";

        // Titulo
        echo "<tr> \n"
            ."<td><strong>T&iacute;tulo:</strong></td> \n"
            ."<td>".$datos_glra->glra_ttlo."</td> \n"
            ."</tr> \n";
        
        // Resumen
        echo "<tr> \n"
            ."<td><strong>Resumen:</strong></td> \n"
            ."<td>".$datos_glra->glra_resm."</td> \n"
            ."</tr> \n";

        // Estado del album	
        echo "<tr> \n"
            ."<td><strong>Estado del album:</v></td> \n"
            ."<td> \n";

        $user_estd = ($datos_glra->glra_estd == "1") ? "Activo" : "Inactivo";

        echo $user_estd."</td> \n"
            ."</tr> \n";

        // Fin de la tabla y el fieldset
        echo "</table> \n"
            ."</fieldset> \n"
            ."</div> \n"
            ."<br>";
    }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

    
    function itl_MailContact($path, $nombre, $email, $asunto, $mensaje, $address, $mserror, $debug){
            
            //SMTP needs accurate times, and the PHP time zone MUST be set
            //This should be done in your php.ini, but this is how to do it if you don't have access to that
            date_default_timezone_set('Etc/UTC');

            // Librerias necesarias
            //require_once $path.'plugins/mail/class.phpmailer.php';
            //require_once $path.'plugins/mail/class.smtp.php';
            require_once $path.'includes/dataforms.php';
            require $path.'components/PHPMailer-master/PHPMailerAutoload.php';

            //Create a new PHPMailer instance
            $mail = new PHPMailer;

            //Tell PHPMailer to use SMTP
            $mail->isSMTP();

            //Enable SMTP debugging
            // 0 = off (for production use)
            // 1 = client messages
            // 2 = client and server messages
            
            if ($debug == "on"){
                $mail->SMTPDebug = 2;
            }
            else {
                $mail->SMTPDebug = 0;
            }

            //Ask for HTML-friendly debug output
            $mail->Debugoutput = 'html';

            //Set the hostname of the mail server
            $mail->Host = 'smtp.gmail.com';

            //Set the SMTP port number - 587 for authenticated TLS, a.k.a. RFC4409 SMTP submission
            $mail->Port = 587;

            //Set the encryption system to use - ssl (deprecated) or tls
            $mail->SMTPSecure = 'tls';

            //Whether to use SMTP authentication
            $mail->SMTPAuth = true;
            

            //Username to use for SMTP authentication - use full email address for gmail
            $mail->Username = "itlabsve@gmail.com";

            //Password to use for SMTP authentication
            $mail->Password = "Mail123iT!";

            //Set who the message is to be sent from
            $mail->setFrom($email, $nombre);

            //Set an alternative reply-to address
            $mail->addReplyTo($email, $nombre);

            //Set who the message is to be sent to
            $mail->addAddress($address, 'Formulario de Contacto');

            
            // configuracion del mensaje de correo
            $mail->From = $email;
            $mail->FromName = $nombre;
            $mail->Subject = $asunto;
            $mail->Body = $mensaje;

            //Read an HTML message body from an external file, convert referenced images to embedded,
            //convert HTML into a basic plain-text alternative body
            //$mail->msgHTML(file_get_contents('contents.html'), dirname(__FILE__));

            //Replace the plain text body with one created manually
            //$mail->MsgHTML($mensaje);
            $mail->AltBody = $mensaje;
            
            
            //$mail->AltBody(strip_tags($mensaje));

            //Attach an image file
            //$mail->addAttachment($path.'plugins/PHPMailer-master/examples/images/phpmailer_mini.png');

            //send the message, check for errors
      
            if (!$mail->send()) {
               $mserror = "error";
            }
            else {
                $mserror = "success";
            }
            
            return $mserror;
            
        }
     
 //------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

        // Funcion para reemplazar caracteres especiales
        function ReemSpecialChars($texto){
            $find = array('치', '칠', '칤', '칩', '칰', '침', '\"', '', '칲', '츼', '칄', '칈', '칍', '칔', '칌', '칖', '칞', '칂', '춸', '춿', '췈', '', '춰', '<', '>', '/', '*', '"');
            $repl = array('&aacute;', '&eacute;', '&iacute;', '&oacute;', '&uacute;', '&ntilde;', '&quot;', '&euro;', '&uuml;', '&Aacute;', '&Eacute;', '&Iacute;', '&Oacute;', '&Uacute;', '&Ntilde;', '&Uuml;', '&ccedil;', '&Ccedil;', '&copy;', '&deg;', '&ordm;', '&iquest;', '&iexcl;', '&lt;', '&gt;', '&#47;', '&#42;', '&quot;');
            $texto_01 = str_replace($find, $repl, $texto);
            $texto_02 = str_replace("'","\'",$texto_01);
            $texto_html = str_replace('"','\"',$texto_02);
            return $texto_html;	
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
    
        // Compartir en redes sociales
        function ShareRS($rdsc, $path){
            
            //    // Archivos requeridos
            require_once $path.'includes/db.php';
            include_once $path.'includes/config.php';
            
            echo "<link href=\"http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css\" rel=\"stylesheet\"> \n"
                ."<link href=\"".$path."/plugins/prettySocial-master/prettySocial.css\" rel=\"stylesheet\"> \n"
                ."<script src=\"http://code.jquery.com/jquery-1.11.0.min.js\"></script> \n"
                ."<script src=\"".$path."/plugins/prettySocial-master/jquery.prettySocial.js\"></script> \n";

            // Control de errores
            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
            echo "<div class=\"social-container\"> \n"
		."<div class=\"links\"> \n";
            
            // Consulta de las redes sociales
            $sql_rdsc = "SELECT rdsc_nomb FROM itlb_rdsc WHERE rdsc_estd = 1";
            $query_rdsc = $conec->itl_dbQuery($sql_rdsc, $debug);

            // Ciclo para mostrar los resultados
            while ($datos_rdsc = $conec->itl_dbFetchObjet($query_rdsc)){
                
                echo "<a href=\"#\" \n"
                    ."data-type=\"".$datos_rdsc->rdsc_nomb."\" \n"
                    ."data-url=\"".$rdsc['data-url']."\" \n"
                    ."data-title=\"".$rdsc['data-title']."\" \n"
                    ."data-description=\"".$rdsc['data-description']."\" \n"
                    ."data-via=\"".$rdsc['data-via']."\" \n"
                    ."data-media=\"".$rdsc['data-media']."\" \n"
                    ."class=\"prettySocial fa fa-".$datos_rdsc->rdsc_nomb."\"></a> \n";
            
            }
            
           echo "</div> \n"

                ."<script type=\"text/javascript\"> \n"
                ."$('.prettySocial').prettySocial(); \n"
		."</script> \n"
                
                ."</div> \n";
        }
        
        
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
        
        function Colores($i){
            switch ($i) {
                case 1:
                    $color = "bgcolor_green";
                break;
                case 2:
                    $color = "bgcolor_blue";
                break;
                case 3:
                    $color = "bgcolor_red";
                break;
                case 4:
                    $color = "bgcolor_cyan";
                break;
                case 5:
                    $color = "bgcolor_purple";
                break;
                case 6:
                    $color = "bgcolor_yellow";
                break;
                case 7:
                    $color = "bgcolor_lightbrown";
                break;
                case 8:
                    $color = "bgcolor_sky";
                break;
                case 9:
                    $color = "bgcolor_magenta";
                break;
                case 10:
                    $color = "bgcolor_darkblue";
                break;
                case 11:
                    $color = "bgcolor_orange";
                break;
                case 12:
                    $color = "bgcolor_seablue";
                break;                   
            }
            return $color;
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
        
        function TasaDeCambio($path, $tarifa_id, $tarifas){
        
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';
            
            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
            // Convertimos la tarifa a un string
            $tarifa = (string)$tarifas;
            
            if (isset($_SESSION['sson_tasa'])){
                $tasa = $_SESSION['sson_tasa'];
            }
            else {
                $tasa = "US";
            }

            if (($tarifa != 0) && ($tarifa != "") && (isset($tarifa))){
                if ($tasa == "VE"){

                    // Consulta de los datos para bolivares
                    $sql_ve = "SELECT itlb_trfa.id AS trfa_id, trfa_tasa, trfa_mrkp, "
                        ."itlb_tasa.id, tasa_cdgo, tasa_nomb, tasa_mnda, tasa_fctr, tasa_cdgo "
                        ."FROM itlb_trfa INNER JOIN itlb_tasa ON (trfa_tasa = itlb_tasa.id) "
                        ."WHERE itlb_trfa.id = '".$tarifa_id."'";
                    $query_ve = $conec->itl_dbQuery($sql_ve, $debug);
                    $datos_ve = $conec->itl_dbFetchObjet($query_ve);

                    $trfa_mrkp = ceil($tarifa / $datos_ve->trfa_mrkp);
                    $trfa_bruta = ceil( $trfa_mrkp * $datos_ve->tasa_fctr);
                    $trfa = number_format($trfa_bruta, 0, ',', '.');
                    $trfa .= " ".$datos_ve->tasa_mnda;
                }
                else {                
                    // Consulta de los datos para otras tasa                 
                    $sql_tasa = "SELECT * FROM itlb_tasa WHERE tasa_cdgo = '".$tasa."' AND tasa_estd = 1";
                    $consulta_tasa = $conec->itl_dbQuery($sql_tasa, $debug);
                    $num_tasa = $conec->itl_dbNumRows($consulta_tasa);
                    $datos_tasa = $conec->itl_dbFetchObjet($consulta_tasa);

                    $sql_trfa = "SELECT id, trfa_tasa, trfa_mrkp "
                        ."FROM itlb_trfa WHERE id = '".$tarifa_id."'";
                    $query_trfa = $conec->itl_dbQuery($sql_trfa, $debug);
                    $datos_trfa = $conec->itl_dbFetchObjet($query_trfa);
                    if ($num_tasa == 1){
                        $trfa_mrkp = ceil($tarifa / $datos_trfa->trfa_mrkp);
                        $trfa_bruta = ceil($trfa_mrkp * $datos_tasa->tasa_fctr);
                        $trfa = number_format($trfa_bruta, 0, ',', '.');
                        $trfa .= " ".$datos_tasa->tasa_mnda;
                    }
                
                }
            }
            else {
                if (!isset($tarifa) || ($tarifa == "")){
                    $trfa = "N/A";
                    $trfa_bruta = 0;
                }
                if ($tarifa == "0"){
                    $trfa = "Free";
                    $trfa_bruta = 0;
                }               
            }
            $tarifa_monto = array();
            $tarifa_monto['mostrar'] = $trfa;
            $tarifa_momto['calcular'] = $trfa_bruta;
            
            return $tarifa_monto;
        }

//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

        function TasaDeCambioPromocion($path, $tarifa_id, $tarifas){
        
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';
            
            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
            // Convertimos la tarifa a un string
            $tarifa = (string)$tarifas;
            
            if (isset($_SESSION['sson_tasa'])){
                $tasa = $_SESSION['sson_tasa'];
            }
            else {
                $tasa = "US";
            }

            if (($tarifa != 0) && ($tarifa != "") && (isset($tarifa))){
                if ($tasa == "VE"){

                    // Consulta de los datos para bolivares
                    $sql_ve = "SELECT itlb_trfa.id AS trfa_id, trfa_tasa, trfa_mrkp, "
                        ."itlb_tasa.id, tasa_cdgo, tasa_nomb, tasa_mnda, tasa_fctr, tasa_cdgo "
                        ."FROM itlb_trfa INNER JOIN itlb_tasa ON (trfa_tasa = itlb_tasa.id) "
                        ."WHERE itlb_trfa.id = '".$tarifa_id."'";
                    $query_ve = $conec->itl_dbQuery($sql_ve, $debug);
                    $datos_ve = $conec->itl_dbFetchObjet($query_ve);

                    $trfa_mrkp = ceil($tarifa / $datos_ve->trfa_mrkp);
                    $trfa_bruta = ceil( $trfa_mrkp * $datos_ve->tasa_fctr);
                    $trfa = number_format($trfa_bruta, 0, ',', '.');
                    $trfa .= " ".$datos_ve->tasa_mnda;
                }
                else {                
                    // Consulta de los datos para otras tasa                 
                    $sql_tasa = "SELECT * FROM itlb_tasa WHERE tasa_cdgo = '".$tasa."' AND tasa_estd = 1";
                    $consulta_tasa = $conec->itl_dbQuery($sql_tasa, $debug);
                    $num_tasa = $conec->itl_dbNumRows($consulta_tasa);
                    $datos_tasa = $conec->itl_dbFetchObjet($consulta_tasa);

                    $sql_trfa = "SELECT id, trfa_tasa, trfa_mrkp "
                        ."FROM itlb_trfa WHERE id = '".$tarifa_id."'";
                    $query_trfa = $conec->itl_dbQuery($sql_trfa, $debug);
                    $datos_trfa = $conec->itl_dbFetchObjet($query_trfa);
                    if ($num_tasa == 1){
                        $trfa_mrkp = ceil($tarifa / $datos_trfa->trfa_mrkp);
                        $trfa_bruta = ceil($trfa_mrkp * $datos_tasa->tasa_fctr);
                        $trfa = number_format($trfa_bruta, 0, ',', '.');
                        $trfa .= " ".$datos_tasa->tasa_mnda;
                    }
                
                }
            }
            else {
                if (!isset($tarifa) || ($tarifa == "")){
                    $trfa = "N/A";
                    $trfa_bruta = 0;
                }
                if ($tarifa == "0"){
                    $trfa = "Free";
                    $trfa_bruta = 0;
                }               
            }
            $tarifa_monto = array();
            $tarifa_monto['mostrar'] = $trfa;
            $tarifa_monto['calcular'] = $trfa_bruta;
            
            return $tarifa_monto;
        }

//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

function TasaDeCambioHistorico($path, $rsrv_id, $tarifas){
        
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';
            
            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
            // Convertimos la tarifa a un string
            $tarifa = (string)$tarifas;
            
            if (isset($_SESSION['sson_tasa'])){
                $tasa = $_SESSION['sson_tasa'];
            }
            else {
                $tasa = "US";
            }

            if (($tarifa != 0) && ($tarifa != "") && (isset($tarifa))){
                if ($tasa == "VE"){

                    // Consulta de los datos para bolivares
                    $sql_ve = "SELECT itlb_rtrf.id AS rtrf_id, rtrf_rtsa, rtrf_mrkp, "
                        ."itlb_rtsa.id, rtsa_cdgo, rtsa_nomb, rtsa_mnda, rtsa_fctr, rtsa_cdgo "
                        ."FROM itlb_rtrf INNER JOIN itlb_rtsa ON (rtrf_rsrv = rtsa_rsrv) "
                        ."WHERE rtrf_rsrv = '".$rsrv_id."'";
                    $query_ve = $conec->itl_dbQuery($sql_ve, $debug);
                    $datos_ve = $conec->itl_dbFetchObjet($query_ve);

                    $trfa_mrkp = ceil($tarifa / $datos_ve->rtrf_mrkp);
                    $trfa_bruta = ceil( $trfa_mrkp * $datos_ve->rtsa_fctr);
                    $trfa = number_format($trfa_bruta, 0, ',', '.');
                    echo $trfa .= " ".$datos_ve->rtsa_mnda;
                }
                else {                
                    // Consulta de los datos para otras tasa                 
                    $sql_tasa = "SELECT * FROM itlb_rtsa WHERE rtsa_cdgo = '".$tasa."' AND rtsa_estd = 1";
                    $consulta_tasa = $conec->itl_dbQuery($sql_tasa, $debug);
                    $num_tasa = $conec->itl_dbNumRows($consulta_tasa);
                    $datos_tasa = $conec->itl_dbFetchObjet($consulta_tasa);

                    $sql_trfa = "SELECT id, rtrf_rtsa, rtrf_mrkp "
                        ."FROM itlb_rtrf WHERE rtrf_rsrv = '".$rsrv_id."'";
                    $query_trfa = $conec->itl_dbQuery($sql_trfa, $debug);
                    $datos_trfa = $conec->itl_dbFetchObjet($query_trfa);
                    if ($num_tasa == 1){
                        $trfa_mrkp = ceil($tarifa / $datos_trfa->rtrf_mrkp)."<br />";
                        $trfa_bruta = ceil($trfa_mrkp * $datos_tasa->rtsa_fctr);
                        $trfa = number_format($trfa_bruta, 0, ',', '.');
                        $trfa .= " ".$datos_tasa->rtsa_mnda;
                    }
                
                }
            }
            else {
                if (!isset($tarifa) || ($tarifa == "")){
                    $trfa = "N/A";
                    $trfa_bruta = 0;
                }
                if ($tarifa == "0"){
                    $trfa = "Free";
                    $trfa_bruta = 0;
                }               
            }
            $tarifa_monto = array();
            $tarifa_monto['mostrar'] = $trfa;
            $tarifa_monto['calcular'] = $trfa_bruta;
            
            return $tarifa_monto;
        }

//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

        function TasaDeCambioValor($path, $tarifa_id, $valor){
        
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';
            
            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
            // Convertimos la tarifa a un string
            $tarifa = (string)$valor;
            
            if (isset($_SESSION['sson_tasa'])){
                $tasa = $_SESSION['sson_tasa'];
            }
            else {
                $tasa = "US";
            }

            if (($valor != 0) && ($valor != "") && (isset($valor))){
                if ($tasa == "VE"){

                    // Consulta de los datos para bolivares
                    $sql_ve = "SELECT itlb_trfa.id AS trfa_id, trfa_tasa, trfa_mrkp, "
                        ."itlb_tasa.id, tasa_cdgo, tasa_nomb, tasa_mnda, tasa_fctr, tasa_cdgo "
                        ."FROM itlb_trfa INNER JOIN itlb_tasa ON (trfa_tasa = itlb_tasa.id) "
                        ."WHERE itlb_trfa.id = '".$tarifa_id."'";
                    $query_ve = $conec->itl_dbQuery($sql_ve, $debug);
                    $datos_ve = $conec->itl_dbFetchObjet($query_ve);

                    $trfa_bruta = ceil( $valor * $datos_ve->tasa_fctr);
                    $valor_tasa = number_format($trfa_bruta, 0, ',', '.');
                    //$valor_tasa = $trfa_bruta;
                    $valor_tasa .= " ".$datos_ve->tasa_mnda;
                    $moneda = $datos_ve->tasa_mnda;
                }
                else {                
                    // Consulta de los datos para otras tasa                 
                    $sql_tasa = "SELECT * FROM itlb_tasa WHERE tasa_cdgo = '".$tasa."' AND tasa_estd = 1";
                    $consulta_tasa = $conec->itl_dbQuery($sql_tasa, $debug);
                    $num_tasa = $conec->itl_dbNumRows($consulta_tasa);
                    $datos_tasa = $conec->itl_dbFetchObjet($consulta_tasa);

                    if ($num_tasa == 1){
                        $trfa_bruta = ceil($valor * $datos_tasa->tasa_fctr);
                        $valor_tasa = number_format($trfa_bruta, 0, ',', '.');
                        //$valor_tasa = $trfa_bruta;
                        $valor_tasa .= " ".$datos_tasa->tasa_mnda;
                        $moneda = $datos_tasa->tasa_mnda;
                    }
                
                }
            }
            else {
                if (!isset($tarifa) || ($tarifa == "")){
                    $valor_tasa = "N/A";
                    $trfa_bruta = 0;
                }
                if ($tarifa == "0"){
                    $valor_tasa = "Free";
                    $trfa_bruta = 0;
                }               
            }
            
            $sql_tasa_moneda = "SELECT tasa_mnda FROM itlb_tasa WHERE tasa_cdgo = '".$tasa."' GROUP BY tasa_nomb";
            $query_tasa_moneda = $conec->itl_dbQuery($sql_tasa_moneda, $debug);
            $datos_tasa_moneda = $conec->itl_dbFetchObjet($query_tasa_moneda);
            
            $tarifa_monto = array();
            $tarifa_monto['mostrar'] = $valor_tasa;
            $tarifa_monto['calcular'] = $trfa_bruta;
            $tarifa_monto['moneda'] = $datos_tasa_moneda->tasa_mnda;
            
            return $tarifa_monto;
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

        function TasaDeCambioMonto($path, $valor){
        
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';
            
            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
            
            if (isset($_SESSION['sson_tasa'])){
                $tasa = $_SESSION['sson_tasa'];
            }
            else {
                $tasa = "US";
            }

            if (($valor != 0) && ($valor != "") && (isset($valor))){
                if ($tasa == "VE"){

                    // Consulta de los datos para bolivares
                    $sql_ve = "SELECT itlb_tasa.id, tasa_cdgo, tasa_nomb, tasa_mnda, tasa_fctr, tasa_cdgo "
                        ."FROM itlb_trfa INNER JOIN itlb_tasa ON (trfa_tasa = itlb_tasa.id) "
                        ."WHERE itlb_trfa.id = '".$tarifa_id."'";
                    $query_ve = $conec->itl_dbQuery($sql_ve, $debug);
                    $datos_ve = $conec->itl_dbFetchObjet($query_ve);

                    $trfa_bruta = ceil( $valor * $datos_ve->tasa_fctr);
                    $valor_tasa = number_format($trfa_bruta, 0, ',', '.');
                    $valor_tasa .= " ".$datos_ve->tasa_mnda;
                }
                else {                
                    // Consulta de los datos para otras tasa                 
                    $sql_tasa = "SELECT * FROM itlb_tasa WHERE tasa_cdgo = '".$tasa."' AND tasa_estd = 1";
                    $consulta_tasa = $conec->itl_dbQuery($sql_tasa, $debug);
                    $num_tasa = $conec->itl_dbNumRows($consulta_tasa);
                    $datos_tasa = $conec->itl_dbFetchObjet($consulta_tasa);

                    if ($num_tasa == 1){
                        $trfa_bruta = ceil($valor * $datos_tasa->tasa_fctr);
                        $valor_tasa = number_format($trfa_bruta, 0, ',', '.');
                        $valor_tasa .= " ".$datos_tasa->tasa_mnda;
                    }
                
                }
            }
            else {
                if (!isset($tarifa) || ($tarifa == "")){
                    $valor_tasa = "N/A";
                }
                if ($tarifa == "0"){
                    $valor_tasa = "Free";
                }               
            }
            return $valor_tasa;
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
        
        function Aviso($tipo, $mensaje){
            echo "<div class=\"alert input_largo ";
                    
                switch ($tipo){

                    case "info":
                        echo "alert-help\"> \n"
                            .$mensaje;
                    break;    

                    case "error":
                        echo "alert-error\"> \n"
                            .$mensaje;
                    break;

                    case "success":
                        echo "alert-success\"> \n"
                            .$mensaje;
                    break;

                    case "warning":
                        echo "alert-notice\"> \n"
                            .$mensaje;
                    break;
                }
            echo "<span class=\"close\"></span> \n"
                ."</div> \n";
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
                    
        function TarifaDesde($path, $hotl_id){
            
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';
            
            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();

            // Consulta de la tarifa mas baja
            $sql_planes_rec = "SELECT itlb_plan.id AS plan_id, plan_nomb, plan_desc, plan_fini, plan_ffin, plan_freg, plan_estd, "
                ."plho_plan, plho_hotl, plho_estd "
                ."FROM itlb_plan "
                ."INNER JOIN itlb_plho on (itlb_plan.id = plho_plan) "
                ."WHERE ((plho_hotl = '".$hotl_id."') AND (plho_estd = 1) AND (plan_estd = 1) AND (plan_ffin >= CURRENT_DATE()))";
            $query_planes_rec = $conec->itl_dbQuery($sql_planes_rec, $debug);
        
            $tarifa_desde = 0; 
            while ($datos_planes_rec = $conec->itl_dbFetchObjet($query_planes_rec)){

                $sql_trfa_rec = "SELECT * FROM itlb_trfa WHERE (trfa_hotl ='".$hotl_id."') AND (trfa_plan = '".$datos_planes_rec->plan_id."')";
                $query_trfa_rec = $conec->itl_dbQuery($sql_trfa_rec, $debug);

                while ($datos_trfa_rec = $conec->itl_dbFetchObjet($query_trfa_rec)){

                    if ($tarifa_desde == 0){
                        if ($datos_trfa_rec->trfa_trpl > 0){
                            $tarifa_desde = $datos_trfa_rec->trfa_trpl;
                            $tarifa_desde_id =  $datos_trfa_rec->id;
                        }
                        elseif($datos_trfa_rec->trfa_dobl > 0){
                            $tarifa_desde = $datos_trfa_rec->trfa_dobl;
                            $tarifa_desde_id =  $datos_trfa_rec->id;
                        }
                        else {
                            $tarifa_desde = $datos_trfa_rec->trfa_senc;
                            $tarifa_desde_id =  $datos_trfa_rec->id;
                        }
                    }
                    if (($tarifa_desde > $datos_trfa_rec->trfa_trpl) && ($datos_trfa_rec->trfa_trpl > 0)){
                        $tarifa_desde = $datos_trfa_rec->trfa_trpl;
                        $tarifa_desde_id =  $datos_trfa_rec->id;
                    }
                    if (($tarifa_desde > $datos_trfa_rec->trfa_dobl) && ($datos_trfa_rec->trfa_dobl > 0)){
                        $tarifa_desde = $datos_trfa_rec->trfa_dobl;
                        $tarifa_desde_id =  $datos_trfa_rec->id;
                    }
                    if (($tarifa_desde > $datos_trfa_rec->trfa_senc) && ($datos_trfa_rec->trfa_senc > 0)){
                        $tarifa_desde = $datos_trfa_rec->trfa_senc;
                        $tarifa_desde_id =  $datos_trfa_rec->id;
                    }
                }
            }
            
            $trfa_desde = array('tarifa_desde' => $tarifa_desde, 'tarifa_desde_id' => $tarifa_desde_id);
            
            return $trfa_desde;
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
            
        // Public Sidebar Ayuda Contacto
        
        function SideBarContactBox($path){
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';

            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
            // Consulta del numero de telefono y la direccion de cooreo electronico
            $sql_contact_box = "SELECT pref_mail, pref_tlf1 FROM itlb_pref WHERE id = 1";
            $query_contact_box = $conec->itl_dbQuery($sql_contact_box, $debug);
            $datos_contact_box = $conec->itl_dbFetchObjet( $query_contact_box);
        
            echo "<div class=\"travelo-box contact-box\"> \n"
                ."<h4>&iexcl;Necesita ayuda?</h4> \n"
                ."<p>Estaremos m&aacute;s que encantados de ayudarle. Nuestro equipo asesor est&aacute; a su servicio para ayudarle.</p> \n"
                ."<address class=\"contact-details\"> \n"
                ."<span class=\"contact-phone\"><i class=\"soap-icon-phone\"></i> ".$datos_contact_box->pref_tlf1."</span> \n"
                ."<br>"
                ."<a class=\"contact-email\" href=\"#\">".$datos_contact_box->pref_mail."</a> \n"
                ."</address> \n"
                ."</div> \n";
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

        function SideBarHotelesRecomendados($path){
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';

            $debug = DEBUG;

            // Crear la instancia y conectar a la BD
            $conec = new itl_db();
            $conec->itl_dbConexion();
            
             //Consulta de los hoteles recomendados
            $sql_hotl_rec = "SELECT itlb_hotl.id AS hotl_id, hotl_ciud, hotl_nomb, hotl_img1, hotl_estd, "
                ."itlb_ciud.id AS ciud_id, ciud_nomb, "
                ."plho_hotl, plho_plan, plho_estd, "
                ."itlb_plan.id AS plan_id, plan_ffin "
                ."FROM itlb_hotl "
                ."INNER JOIN itlb_ciud ON (hotl_ciud = itlb_ciud.id) "
                ."INNER JOIN itlb_plho on (itlb_hotl.id = plho_hotl) "
                ."INNER JOIN itlb_plan on (itlb_plan.id = plho_plan) "
                ."WHERE (hotl_estd = '1') AND (hotl_dest = '1') AND (plho_estd = 1) AND (plan_estd = 1) AND (plan_ffin >= CURRENT_DATE()) "
                ."GROUP BY hotl_nomb "
                ."LIMIT 10";
            $consulta_hotl_rec = $conec->itl_dbQuery($sql_hotl_rec, $debug);

            echo "<div class=\"travelo-box\"> \n"
                ."<h4>Tambien Puedes Ver</h4> \n"
                ."<div class=\"image-box style14\"> \n";
                    
            while ($registro_hotl_rec = $conec->itl_dbFetchObjet($consulta_hotl_rec)){ 
        
                // Calculo de la menor tarifa
                $td = TarifaDesde($path, $registro_hotl_rec->hotl_id);
                $tarifa_desde = TasaDeCambio($path, $td['tarifa_desde_id'], $td['tarifa_desde']);

                echo "<article class=\"box\"> \n"
                    ."<figure> \n"
                    ."<a href=\"".$path."public/hotel.php?hotl_id=".$registro_hotl_rec->hotl_id."\"> \n"
                    ."<img src=\"".$path."thumbs/imagenes/hoteles/".$registro_hotl_rec->hotl_img1."\" alt=\"\" /> \n"
                    ."</a> \n"
                    ."</figure> \n"
                    ."<div class=\"details hoteles_recomendados_sidebar\"> \n"
                    ."<h5 class=\"box-title\"> \n"
                    ."<a href=\"".$path."public/hotel.php?hotl_id=".$registro_hotl_rec->hotl_id."\">".$registro_hotl_rec->hotl_nomb."</a> \n"
                    ."</h5> \n"
                    ."<label class=\"price-wrapper\"> \n"
                    ."Desde \n"
                    ."<span class=\"price-per-unit\">".$tarifa_desde['mostrar']."</span> \n"
                    ."</label> \n"
                    ."</div> \n"
                    ."</article> \n";
            }        

            echo "</div> \n"
                ."</div> \n";
        }    
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	
        
        function PHPCodigoQR($path, $contenido, $directorio, $nombre){
            
            // Inclusion de archivos necesarios
            require_once $path.'includes/db.php';
            require_once $path.'includes/config.php';
            include_once $path.'components/phpqrcode/qrlib.php';

            // Directorio donde guardar la imagen
            $tempDir = $path.$directorio."/"; 

            $pngAbsoluteFilePath = $tempDir.$nombre.".png"; 

            // generating 
            if (!file_exists($pngAbsoluteFilePath)) { 
                QRcode::png($contenido, $pngAbsoluteFilePath); 
            } 
        }
//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//	

?>
