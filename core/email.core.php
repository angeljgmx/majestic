<?php

    /********************************************************/
    /* Administrador Web SmartNova                            */
    /* Funciones de email                                   */
    /* Junio de 2016                                        */
    /********************************************************/

//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function itl_MailContact($path, $nombre, $email, $asunto, $mensaje, $address, $mserror, $debug){
            
        //SMTP needs accurate times, and the PHP time zone MUST be set
        //This should be done in your php.ini, but this is how to do it if you don't have access to that
        date_default_timezone_set('Etc/UTC');

        // Librerias necesarias
        //require_once $path.'plugins/mail/class.phpmailer.php';
        //require_once $path.'plugins/mail/class.smtp.php';
        require $path.'assets/global/plugins/PHPMailer-master/PHPMailerAutoload.php';

        //Create a new PHPMailer instance
        $mail = new PHPMailer;

        //Tell PHPMailer to use SMTP
        $mail->isSMTP();

        //Enable SMTP debugging
        // 0 = off (for production use)
        // 1 = client messages
        // 2 = client and server messages
        //$debug = "on";
        if ($debug == "on"){
            $mail->SMTPDebug = 2;
        }
        else {
            $mail->SMTPDebug = 0;
        }

        //Ask for HTML-friendly debug output
        $mail->Debugoutput = 'html';

        // Nombre del servidor de correos
        $mail->Host = 'smtp.gmail.com';

        // Numero de puerto de servidor de correo
        $mail->Port = 587;

        // Seguridad del servidor de correo - ssl (deprecated) o tls
        $mail->SMTPSecure = 'tls';

        // Autentificado del servidor de correo
        $mail->SMTPAuth = true;

        // Nombre de usuario del servidor SMTP
        $mail->Username = "centroastronomicocaronte@gmail.com";

        // Password del usuario
        $mail->Password = "caronteunet";

        //Set who the message is to be sent from
        $mail->setFrom($email, $nombre);

        //Set an alternative reply-to address
        $mail->addReplyTo($email, $nombre);

        //Set who the message is to be sent to
        $mail->addAddress($address, 'Formulario de Contacto');


        // configuracion del mensaje de correo
        $mail->From = $email;
        $mail->FromName = $nombre;
        $mail->Subject = $asunto;
        $mail->Body = $mensaje;

        //Read an HTML message body from an external file, convert referenced images to embedded,
        //convert HTML into a basic plain-text alternative body
        //$mail->msgHTML(file_get_contents('contents.html'), dirname(__FILE__));

        //Replace the plain text body with one created manually
        //$mail->MsgHTML($mensaje);
        $mail->AltBody = $mensaje;


        //$mail->AltBody(strip_tags($mensaje));

        //Attach an image file
        //$mail->addAttachment($path.'plugins/PHPMailer-master/examples/images/phpmailer_mini.png');

        //send the message, check for errors

        if (!$mail->send()) {
            $mserror = "error";
        }
        else {
            $mserror = "success";
        }

        return $mserror; 
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
