<?php

    /********************************************************/
    /* Administrador Web SmartNova                            */
    /* Formularios                                          */
    /* Junio de 2016                                        */
    /********************************************************/

//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    function OptionGetPost($path){
        
        // Inclusion de archivos necesarios
        require_once $path.'includes/config.inc.php';
        
        $debug = DEBUG;
       
        //Recepcion  de variable de opcion por GET
        if((!isset($_GET['op'])) && (!isset($_POST['op']))){
            $opcion = "listar";
        }
        else{
            if(!isset($_GET['op'])){
                $opcion = $_POST['op'];
                if ($debug == "on"){
                    echo "*** el valor de \$op _POST = ".@$_POST['op']."***";
                }
            }
            else{
                $opcion = $_GET['op'];
                if ($debug == "on"){
                    echo "*** el valor de \$op _GET = ".@$_GET['op']."***";
                }
            }
        }
        return $opcion;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    // Funcion para obtener la direccion ip de los clientes
    function GetClientIP() {
        $ipaddress = '';
        if (isset($_SERVER['HTTP_CLIENT_IP']))
            $ipaddress = $_SERVER['HTTP_CLIENT_IP'];
        else if(isset($_SERVER['HTTP_X_FORWARDED_FOR']))
            $ipaddress = $_SERVER['HTTP_X_FORWARDED_FOR'];
        else if(isset($_SERVER['HTTP_X_FORWARDED']))
            $ipaddress = $_SERVER['HTTP_X_FORWARDED'];
        else if(isset($_SERVER['HTTP_FORWARDED_FOR']))
            $ipaddress = $_SERVER['HTTP_FORWARDED_FOR'];
        else if(isset($_SERVER['HTTP_FORWARDED']))
            $ipaddress = $_SERVER['HTTP_FORWARDED'];
        else if(isset($_SERVER['REMOTE_ADDR']))
            $ipaddress = $_SERVER['REMOTE_ADDR'];
        else
            $ipaddress = 'IP Desconocida';
            //echo $ipaddress;
        return $ipaddress;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    // Funcion para llenar de ceros a la izquierda un valor
    function zerofill($valor, $longitud){
        $res = str_pad($valor, $longitud, '0', STR_PAD_LEFT);
        return $res;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    
    // Funcion para determinar la url actual
    function GetURL(){
        $url="http://".$_SERVER['HTTP_HOST'].":".$_SERVER['SERVER_PORT'].$_SERVER['REQUEST_URI'];
        return $url;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

    // Funcion para guardar visitas
    function GuardarVisitas($path, $vist_tbla, $vist_idrg){   
        
        // Inclusion de archivos necesarios
        require_once $path.'core/db.class.core.php';
        require_once $path.'includes/config.inc.php';
        
        $debug = DEBUG;
        
        // Crear la instancia y conectar a la BD
        $conec = new db();
        $conec->dbConexion(); 
       
        // Consultar si existe el registro para la visita
        $sql_vext = "SELECT * FROM tbla_vist WHERE (vist_tbla = '".$vist_tbla."' AND vist_idrg = '".$vist_idrg."')";
        $query_vext = $conec->dbQuery($sql_vext, $debug);
        $nvext = $conec->dbNumRows($query_vext);
        
        if ($nvext > 0){
            $datos_vext = $conec->dbFetchObjet($query_vext);
            $visitas = $datos_vext->vist_vist + 1;
                   
            $sql_vupt = "UPDATE tbla_vist SET vist_vist = ".$visitas.", vist_freg = now() WHERE vist_tbla = '".$vist_tbla."' AND  vist_idrg = '".$vist_idrg."'";
            $conec->dbQuery($sql_vupt, $debug);
        }
        else {
            // Guardar la visita      
            $qvist = "INSERT INTO tbla_vist (vist_tbla, vist_idrg, vist_vist) VALUES ('".$vist_tbla."', '".$vist_idrg."', 1)";
            $conec->dbQuery($qvist, $debug);
        }
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
    
    // Funcion para calcular el maximo id de una tabla
    function MAXid($path, $tabla){
        
        // Inclusion de archivos necesarios
        require_once $path.'core/db.class.core.php';
        require_once $path.'includes/config.inc.php';
        
        $debug = DEBUG;
        
        // Crear la instancia y conectar a la BD
        $conec = new db();
        $conec->dbConexion(); 
  
        $sql_maxid = "SELECT MAX(id) AS id FROM ".$tabla;
        $query_maxid = $conec->dbQuery($sql_maxid, $debug);
        $datos_maxid = $conec->dbFetchArray($query_maxid);
        $maxid = $datos_maxid['id'];
        
        return $maxid;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//
        
    // Funcion para calcular el minimo id de una tabla
    function MINid($path, $tabla){
        
        // Inclusion de archivos necesarios
        require_once $path.'core/db.class.core.php';
        require_once $path.'includes/config.inc.php';
        
        $debug = DEBUG;
        
        // Crear la instancia y conectar a la BD
        $conec = new db();
        $conec->dbConexion(); 
  
        $sql_minid = "SELECT MIN(id) AS id FROM ".$tabla;
        $query_minid = $conec->dbQuery($sql_minid, $debug);
        $datos_minid = $conec->dbFetchArray($query_minid);
        $minid = $datos_minid['id'];
    
        return $minid;
    }
//--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------//

?>